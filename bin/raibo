#!/usr/bin/env ruby

$:.unshift File.expand_path('../../lib', __FILE__)

require 'raibo'
require 'optparse'
require 'ostruct'

options = OpenStruct.new
options.botfile = 'Botfile'
options.room    = 'Raibo'
options.token   = 'f79844da660439c4f52ba87061eead2674bbfd78'
options.verbose = false

opts = OptionParser.new do |o|
  o.banner = "Usage: raibo <subdomain> [options]"

  o.on("-b", "--botfile [FILE]",
       "specify the location of the bot's configuration (default is \"./Botfile\")") do |file|
    options.botfile = file
  end

  o.on("-r", "--room [ROOM]",
       "specify the room to use (default is \"raibo\")") do |room|
    options.room = room
 end

  o.on("-v", "--verbose", "show every incoming and outgoing line") do
    options.verbose = true
  end

  o.on("-V", "--version", "show raibo's version") do
    puts Raibo::VERSION
    exit 0
  end

  o.on("-h", "--help", "show this message") do
    puts opts
    exit 0
  end
end
opts.parse!(ARGV)

if ARGV.length != 1
  puts opts
  exit 1
end

subdomain = ARGV.shift

b = Raibo::Bot.new(subdomain,
				   :token   => options.token,
                   :room => options.room,
                   :verbose => options.verbose)
b.load_config_file(options.botfile)
b.run
